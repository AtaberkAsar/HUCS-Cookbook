from fastapi import FastAPI, Form, Request
from fastapi.responses import HTMLResponse, FileResponse
from fastapi.templating import Jinja2Templates
from fastapi.staticfiles import StaticFiles

from driver import *

app = FastAPI(
    docs_url=None,
    redoc_url=None
)
app.IS_SAFE = ""

app.mount("/static", StaticFiles(directory="static"), name="static")
templates = Jinja2Templates(directory="templates")

@app.get("/", response_class=HTMLResponse)
def read_root(request: Request):
    return templates.TemplateResponse("index.html", {"request": request, "response_content": "", "is_safe": app.IS_SAFE})

@app.get("/submit", response_class=HTMLResponse)
def submit_form(request: Request, input1: str, input2: str, input3: str):
    
    response = ""
    
    if (not app.IS_SAFE):
        if input1 != "":
            response = xss_function(input1)
        elif input2 != "":
            response = sql_funtion(input2)
        elif input3 != "":
            response = ping_function(input3)
    else:
        if input1 != "":
            response = xss_safe(input1)
        elif input2 != "":
            response = sql_safe(input2)
        elif input3 != "":
            response = ping_safe_regex(input3)

    return templates.TemplateResponse("index.html", {"request": request, "response_content": response, "is_safe": app.IS_SAFE})

@app.get("/toggle/{cb}", include_in_schema=False)
def toggle(cb):
    app.IS_SAFE = "checked" if cb == "true" else ""

# <script>alert()</script>
# " UNION SELECT 1, version() --
# " UNION SELECT 1, sqlite_version() --
# " UNION SELECT 1, tbl_name FROM sqlite_master WHERE type="table" --
# " UNION SELECT 1, sql FROM sqlite_master WHERE name="users" --
# 8.8.8.8 & dir